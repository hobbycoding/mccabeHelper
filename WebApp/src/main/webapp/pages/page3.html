<!DOCTYPE HTML>
<html>

<head>
    <title>examples</title>
    <meta name="description" content=""/>
    <meta name="keywords" content=""/>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
    <link rel="stylesheet" type="text/css" href="../style/style.css"/>
    <script src="./script.js"></script>
    <script src="../lib/codemirror-5.33.0/lib/codemirror.js"></script>
    <link rel="stylesheet" href="../lib/codemirror-5.33.0/lib/codemirror.css"/>
    <script src="../lib/codemirror-5.33.0/addon/edit/matchbrackets.js"></script>
    <script src="../lib/codemirror-5.33.0/mode/clike/clike.js"></script>
</head>

<body>
<div id="main">
    <div id="header">
        <div id="logo">
            <div id="logo_text">
                <!-- class="logo_colour", allows you to change the colour of the text -->
                <h1><a href="../index.html">Report<span class="logo_colour">Result</span></a></h1>
                <h2>.</h2>
            </div>
        </div>
        <div id="menubar">
            <ul id="menu">
                <!-- put class="selected" in the li tag for the selected page - to highlight which page you're on -->
                <li><a href="../index.html">Home</a></li>
                <li><a href="page1.html">pages1</a></li>
                <li><a href="page2.html">pages2</a></li>
                <li class="selected"><a href="page3.html">pages3</a></li>
                <li><a href="page4.html">pages4</a></li>
            </ul>
        </div>
    </div>
    <div id="content_header"></div>
    <div id="site_content">
        <div class="form_settings">
            <select id="jobNameList" onmousedown="value = ''" onchange="gettables(value);"/>
            <input type="submit" value="refresh" onclick="getJobNameList(document.getElementById('search').value);" class="submit" style="float:right">
            <input id="search" type="date" name="name" value="" style="float:right"/>
        </div>
        <div id="tables" style="margin: 0 auto; overflow: hidden; height: 300px; text-align:center; min-width :1300px">
            <div id="a" class="inline">
                <table class="inlineTable">
                    <tr><th>Item</th><th>Description</th></tr>
                    <tr><td>Item 1</td><td>Description of Item 1</td></tr>
                    <tr><td>Item 2</td><td>Description of Item 2</td></tr>
                    <tr><td>Item 3</td><td>Description of Item 3</td></tr>
                    <tr><td>Item 4</td><td>Description of Item 4</td></tr>
                    <tr><td>Item 1</td><td>Description of Item 1</td></tr>
                    <tr><td>Item 2</td><td>Description of Item 2</td></tr>
                    <tr><td>Item 3</td><td>Description of Item 3</td></tr>
                    <tr><td>Item 4</td><td>Description of Item 4</td></tr>
                    <tr><td>Item 2</td><td>Description of Item 2</td></tr>
                    <tr><td>Item 3</td><td>Description of Item 3</td></tr>
                    <tr><td>Item 4</td><td>Description of Item 4</td></tr>
                </table>
            </div>
            <div id="b" class="inline">
                <table class="inlineTable">
                    <tr><th>Item</th><th>Description</th></tr>
                    <tr><td>Item 1</td><td>Description of Item 1</td></tr>
                    <tr><td>Item 2</td><td>Description of Item 2</td></tr>
                    <tr><td>Item 3</td><td>Description of Item 3</td></tr>
                    <tr><td>Item 4</td><td>Description of Item 4</td></tr>
                    <tr><td>Item 1</td><td>Description of Item 1</td></tr>
                    <tr><td>Item 2</td><td>Description of Item 2</td></tr>
                    <tr><td>Item 3</td><td>Description of Item 3</td></tr>
                    <tr><td>Item 4</td><td>Description of Item 4</td></tr>
                    <tr><td>Item 2</td><td>Description of Item 2</td></tr>
                    <tr><td>Item 3</td><td>Description of Item 3</td></tr>
                    <tr><td>Item 4</td><td>Description of Item 4</td></tr>
                </table>
            </div>
            <div id="c" class="inline">
                <table class="inlineTable">
                    <tr><th>Item</th><th>Description</th></tr>
                    <tr><td>Item 1</td><td>Description of Item 1</td></tr>
                    <tr><td>Item 2</td><td>Description of Item 2</td></tr>
                    <tr><td>Item 3</td><td>Description of Item 3</td></tr>
                    <tr><td>Item 4</td><td>Description of Item 4</td></tr>
                    <tr><td>Item 1</td><td>Description of Item 1</td></tr>
                    <tr><td>Item 2</td><td>Description of Item 2</td></tr>
                    <tr><td>Item 3</td><td>Description of Item 3</td></tr>
                    <tr><td>Item 4</td><td>Description of Item 4</td></tr>
                    <tr><td>Item 2</td><td>Description of Item 2</td></tr>
                    <tr><td>Item 3</td><td>Description of Item 3</td></tr>
                    <tr><td>Item 4</td><td>Description of Item 4</td></tr>
                </table>
            </div>
        </div>
        <div class="tab">
            <button class="tablinks" onclick="openTab(event, 'source')">Source</button>
        </div>
        <!-- Tab content -->
        <div id="source" class="tabcontent">
            <textarea id="sourceArea" name="sourceArea">package com.mccabe.rest;

import org.json.simple.JSONArray;
import org.json.simple.JSONObject;
import org.json.simple.parser.JSONParser;

import javax.naming.Context;
import javax.naming.InitialContext;
import javax.sql.DataSource;
import java.sql.*;

public class DBService {

    // property : method [getOverView, detailView, getExcel], where [ex)2017-12-11],
    // ex) {"method" : "getOverView", "where" : "2017-12-11"}
    public String doProcess(String msg) {
        JSONArray result = null;
        try {
            JSONObject jsonObject = (JSONObject) new JSONParser().parse(msg);
            switch (jsonObject.get("method").toString()) {
                case "getOverView":
                    result = getDataFromTable(Query.getOverView(jsonObject.get("where").toString()));
                    break;
                case "getCategoryList":
                    result = getDataFromTable(Query.getCategoryList(jsonObject.get("where").toString()));
                    break;
                case "getSubDetailView":
                    result = getDataFromTable(Query.getSubDetailView(jsonObject));
                    break;
                case "detailView":
                    result = getDataFromTable(Query.getDetailView(jsonObject.get("where")));
                    break;
            }
        } catch (Exception e) {
            e.printStackTrace();
        }
        return result.toString();
    }

    private JSONArray getDataFromTable(String query) throws Exception {
        Statement statement = getConnection();
        ResultSet resultSet = statement.executeQuery(query);
        JSONArray result = mashalingJSON(resultSet);
        statement.getConnection().close();
        return result;
    }

    private Statement getConnection() throws Exception {
        String ejb = "mccabe/oracle";
        String normal = "java:comp/env/mccabe/oracle";
        final Context initContext = new InitialContext();
        DataSource ds = (DataSource) initContext.lookup(normal);
        if (ds != null) {
            return ds.getConnection().createStatement();
        }
        throw new Exception("can't find mccabe/oracle.");
    }

    private JSONArray mashalingJSON(ResultSet rs) throws SQLException {
        JSONArray json = new JSONArray();
        ResultSetMetaData rsmd = rs.getMetaData();
        while (rs.next()) {
            int numColumns = rsmd.getColumnCount();
            JSONObject obj = new JSONObject();
            for (int i = 1; i <= numColumns; i++) {
                String column_name = rsmd.getColumnName(i);
                obj.put(Query.Category.valueOf(column_name).getDesc(), rs.getObject(column_name));
            }
            json.add(obj);
        }
        return json;
    }
}
</textarea>
        </div>
    </div>
    <div id="content_footer"></div>
    <div id="footer">
        Copyright &copy; TestMine | <a href="http://validator.w3.org/check?uri=referer">HTML5</a> | <a
            href="http://jigsaw.w3.org/css-validator/check/referer">CSS</a> | <a
            href="http://www.html5webtemplates.co.uk">Website templates</a>
    </div>
</div>
<script>
    document.getElementById("search").valueAsDate = new Date();
</script>
</body>
</html>
